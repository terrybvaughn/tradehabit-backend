"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_terry_projects_tradehabit_backend_mentor_chat_ui_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/chat/route.ts */ \"(rsc)/./src/app/api/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    resolvedPagePath: \"/Users/terry/projects/tradehabit-backend/mentor/chat-ui/src/app/api/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_terry_projects_tradehabit_backend_mentor_chat_ui_src_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnRlcnJ5JTJGcHJvamVjdHMlMkZ0cmFkZWhhYml0LWJhY2tlbmQlMkZtZW50b3IlMkZjaGF0LXVpJTJGc3JjJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRnRlcnJ5JTJGcHJvamVjdHMlMkZ0cmFkZWhhYml0LWJhY2tlbmQlMkZtZW50b3IlMkZjaGF0LXVpJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNpQztBQUM5RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL21lbnRvci1jaGF0LXVpLz8yMTkxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy90ZXJyeS9wcm9qZWN0cy90cmFkZWhhYml0LWJhY2tlbmQvbWVudG9yL2NoYXQtdWkvc3JjL2FwcC9hcGkvY2hhdC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2hhdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NoYXRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NoYXQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvdGVycnkvcHJvamVjdHMvdHJhZGVoYWJpdC1iYWNrZW5kL21lbnRvci9jaGF0LXVpL3NyYy9hcHAvYXBpL2NoYXQvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2NoYXQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/chat/route.ts":
/*!***********************************!*\
  !*** ./src/app/api/chat/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _src_lib_runAssistant__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/src/lib/runAssistant */ \"(rsc)/./src/lib/runAssistant.ts\");\n\n\nasync function POST(req) {\n    try {\n        const { message, threadId } = await req.json();\n        if (!message || typeof message !== \"string\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing 'message'\"\n            }, {\n                status: 400\n            });\n        }\n        const result = await (0,_src_lib_runAssistant__WEBPACK_IMPORTED_MODULE_1__.runAssistantTurn)({\n            threadId,\n            userText: message\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result);\n    } catch (err) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: err?.message || \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9jaGF0L3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUEyQztBQUNlO0FBRW5ELGVBQWVFLEtBQUtDLEdBQVk7SUFDckMsSUFBSTtRQUNGLE1BQU0sRUFBRUMsT0FBTyxFQUFFQyxRQUFRLEVBQUUsR0FBRyxNQUFNRixJQUFJRyxJQUFJO1FBQzVDLElBQUksQ0FBQ0YsV0FBVyxPQUFPQSxZQUFZLFVBQVU7WUFDM0MsT0FBT0oscURBQVlBLENBQUNNLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFvQixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDekU7UUFFQSxNQUFNQyxTQUFTLE1BQU1SLHVFQUFnQkEsQ0FBQztZQUFFSTtZQUFVSyxVQUFVTjtRQUFRO1FBQ3BFLE9BQU9KLHFEQUFZQSxDQUFDTSxJQUFJLENBQUNHO0lBQzNCLEVBQUUsT0FBT0UsS0FBVTtRQUNqQixPQUFPWCxxREFBWUEsQ0FBQ00sSUFBSSxDQUFDO1lBQUVDLE9BQU9JLEtBQUtQLFdBQVc7UUFBZ0IsR0FBRztZQUFFSSxRQUFRO1FBQUk7SUFDckY7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21lbnRvci1jaGF0LXVpLy4vc3JjL2FwcC9hcGkvY2hhdC9yb3V0ZS50cz80NmI3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgcnVuQXNzaXN0YW50VHVybiB9IGZyb20gXCJAL3NyYy9saWIvcnVuQXNzaXN0YW50XCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgbWVzc2FnZSwgdGhyZWFkSWQgfSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgaWYgKCFtZXNzYWdlIHx8IHR5cGVvZiBtZXNzYWdlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJNaXNzaW5nICdtZXNzYWdlJ1wiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuQXNzaXN0YW50VHVybih7IHRocmVhZElkLCB1c2VyVGV4dDogbWVzc2FnZSB9KTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0KTtcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyPy5tZXNzYWdlIHx8IFwiVW5rbm93biBlcnJvclwiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwicnVuQXNzaXN0YW50VHVybiIsIlBPU1QiLCJyZXEiLCJtZXNzYWdlIiwidGhyZWFkSWQiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJyZXN1bHQiLCJ1c2VyVGV4dCIsImVyciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/openai.ts":
/*!***************************!*\
  !*** ./src/lib/openai.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ASSISTANT_ID: () => (/* binding */ ASSISTANT_ID),\n/* harmony export */   TOOL_RUNNER_BASE_URL: () => (/* binding */ TOOL_RUNNER_BASE_URL),\n/* harmony export */   openai: () => (/* binding */ openai)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nconst ASSISTANT_ID = process.env.ASSISTANT_ID;\nconst TOOL_RUNNER_BASE_URL = process.env.TOOL_RUNNER_BASE_URL;\nif (!process.env.OPENAI_API_KEY) throw new Error(\"Missing OPENAI_API_KEY\");\nif (!ASSISTANT_ID) throw new Error(\"Missing ASSISTANT_ID env var\");\nif (!TOOL_RUNNER_BASE_URL) throw new Error(\"Missing TOOL_RUNNER_BASE_URL env var\");\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL29wZW5haS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTRCO0FBRXJCLE1BQU1DLFNBQVMsSUFBSUQsOENBQU1BLENBQUM7SUFBRUUsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO0FBQUMsR0FBRztBQUVsRSxNQUFNQyxlQUFlSCxRQUFRQyxHQUFHLENBQUNFLFlBQVksQ0FBVztBQUN4RCxNQUFNQyx1QkFBdUJKLFFBQVFDLEdBQUcsQ0FBQ0csb0JBQW9CLENBQVc7QUFFL0UsSUFBSSxDQUFDSixRQUFRQyxHQUFHLENBQUNDLGNBQWMsRUFBRSxNQUFNLElBQUlHLE1BQU07QUFDakQsSUFBSSxDQUFDRixjQUFjLE1BQU0sSUFBSUUsTUFBTTtBQUNuQyxJQUFJLENBQUNELHNCQUFzQixNQUFNLElBQUlDLE1BQU0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZW50b3ItY2hhdC11aS8uL3NyYy9saWIvb3BlbmFpLnRzP2E1YzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5cbmV4cG9ydCBjb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHsgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSB9KTtcblxuZXhwb3J0IGNvbnN0IEFTU0lTVEFOVF9JRCA9IHByb2Nlc3MuZW52LkFTU0lTVEFOVF9JRCBhcyBzdHJpbmc7XG5leHBvcnQgY29uc3QgVE9PTF9SVU5ORVJfQkFTRV9VUkwgPSBwcm9jZXNzLmVudi5UT09MX1JVTk5FUl9CQVNFX1VSTCBhcyBzdHJpbmc7XG5cbmlmICghcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkpIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgT1BFTkFJX0FQSV9LRVlcIik7XG5pZiAoIUFTU0lTVEFOVF9JRCkgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBBU1NJU1RBTlRfSUQgZW52IHZhclwiKTtcbmlmICghVE9PTF9SVU5ORVJfQkFTRV9VUkwpIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgVE9PTF9SVU5ORVJfQkFTRV9VUkwgZW52IHZhclwiKTsiXSwibmFtZXMiOlsiT3BlbkFJIiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiQVNTSVNUQU5UX0lEIiwiVE9PTF9SVU5ORVJfQkFTRV9VUkwiLCJFcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/openai.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/runAssistant.ts":
/*!*********************************!*\
  !*** ./src/lib/runAssistant.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   runAssistantTurn: () => (/* binding */ runAssistantTurn)\n/* harmony export */ });\n/* harmony import */ var _openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./openai */ \"(rsc)/./src/lib/openai.ts\");\n// /tradehabit-backend/mentor/chat-ui/src/lib/runAssistant.ts\n\n// ---------- tiny retry/backoff for OpenAI 429s ----------\nasync function withRetry(fn, tries = 3) {\n    let delay = 800;\n    let lastErr;\n    for(let i = 0; i < tries; i++){\n        try {\n            return await fn();\n        } catch (e) {\n            lastErr = e;\n            const status = e?.status || e?.response?.status;\n            const msg = e?.message || e?.response?.data || \"\";\n            const rateLimited = status === 429 || /rate limit|Too Many Requests/i.test(msg);\n            if (!rateLimited) break;\n            await new Promise((r)=>setTimeout(r, delay));\n            delay *= 2;\n        }\n    }\n    throw lastErr || new Error(\"Retry limit reached\");\n}\n// ---------- helper: safe POST JSON to tool_runner ----------\nasync function postJSON(url, payload) {\n    try {\n        const res = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(payload ?? {})\n        });\n        const data = await res.json().catch(()=>({}));\n        return {\n            ok: res.ok,\n            data\n        };\n    } catch (e) {\n        return {\n            ok: false,\n            data: {\n                status: \"ERROR\",\n                message: `tool_runner fetch failed: ${e?.message || String(e)}`\n            }\n        };\n    }\n}\n// ---------- tool runner bridge ----------\nasync function callToolRunner(name, args, userText) {\n    // get_summary_data is always tiny\n    if (name === \"get_summary_data\") {\n        const { data } = await postJSON(`${_openai__WEBPACK_IMPORTED_MODULE_0__.TOOL_RUNNER_BASE_URL}/get_summary_data`, {});\n        return data;\n    }\n    // get_endpoint_data with safe defaults and fallback to keys_only\n    if (name === \"get_endpoint_data\") {\n        const safeArgs = {\n            ...args || {}\n        };\n        // Guard against full-file dumps unless paging a top-level array\n        const callerSpecifiedKeysOnly = Object.prototype.hasOwnProperty.call(safeArgs, \"keys_only\");\n        if (!callerSpecifiedKeysOnly && !safeArgs.top) safeArgs.keys_only = true;\n        // If paging a big array and no projection specified, keep it lean\n        if (safeArgs.top === \"trades\" && !Array.isArray(safeArgs.fields)) {\n            safeArgs.fields = [\n                \"id\",\n                \"entryTime\",\n                \"symbol\",\n                \"pnl\",\n                \"mistakes\"\n            ];\n        }\n        // Clamp page size\n        const reqSize = Number(safeArgs.max_results);\n        safeArgs.max_results = Number.isFinite(reqSize) && reqSize > 0 ? Math.min(reqSize, 10) : 10;\n        // First attempt\n        let { ok, data } = await postJSON(`${_openai__WEBPACK_IMPORTED_MODULE_0__.TOOL_RUNNER_BASE_URL}/get_endpoint_data`, safeArgs);\n        // If the server errored (bad `top`, etc.) â†’ fallback to keys_only\n        if (!ok) {\n            ({ data } = await postJSON(`${_openai__WEBPACK_IMPORTED_MODULE_0__.TOOL_RUNNER_BASE_URL}/get_endpoint_data`, {\n                name: safeArgs.name,\n                keys_only: true\n            }));\n            return data;\n        }\n        // If we defaulted to keys_only and the payload looks scalar-only (no arrays),\n        // auto-fetch the full snapshot so Franklin can read actual values.\n        const weDefaultedKeysOnly = !callerSpecifiedKeysOnly && !args?.top;\n        const looksScalarOnly = data && typeof data === \"object\" && Array.isArray(data.keys) && data.keys.length > 0 && data.array_lengths && Object.values(data.array_lengths).every((n)=>typeof n === \"number\" && n === 0);\n        if (weDefaultedKeysOnly && looksScalarOnly) {\n            const full = await postJSON(`${_openai__WEBPACK_IMPORTED_MODULE_0__.TOOL_RUNNER_BASE_URL}/get_endpoint_data`, {\n                name: safeArgs.name\n            });\n            return full.data;\n        }\n        return data;\n    }\n    // filter_trades\n    if (name === \"filter_trades\") {\n        const safe = {\n            include_total: true,\n            ...args || {}\n        };\n        // Strip placeholder 'any'\n        if (Array.isArray(safe.mistakes)) {\n            safe.mistakes = safe.mistakes.filter((m)=>(m || \"\").toLowerCase() !== \"any\");\n            if (safe.mistakes.length === 0) delete safe.mistakes;\n        }\n        // Default projection\n        if (!Array.isArray(safe.fields)) {\n            safe.fields = [\n                \"id\",\n                \"entryTime\",\n                \"symbol\",\n                \"pnl\",\n                \"mistakes\"\n            ];\n        }\n        // Clamp page size\n        const reqSize = Number(safe.max_results);\n        safe.max_results = Number.isFinite(reqSize) && reqSize > 0 ? Math.min(reqSize, 10) : 10;\n        const { data } = await postJSON(`${_openai__WEBPACK_IMPORTED_MODULE_0__.TOOL_RUNNER_BASE_URL}/filter_trades`, safe);\n        return data;\n    }\n    // filter_losses\n    if (name === \"filter_losses\") {\n        const safe = {\n            include_total: true,\n            ...args || {}\n        };\n        // Default projection\n        if (!Array.isArray(safe.fields)) {\n            safe.fields = [\n                \"exitOrderId\",\n                \"entryTime\",\n                \"pointsLost\",\n                \"symbol\",\n                \"side\",\n                \"hasMistake\"\n            ];\n        }\n        // Optional nudge for â€œworst/biggest/largest/max lossâ€\n        const txt = (typeof userText === \"string\" ? userText : \"\").toLowerCase();\n        if (!safe.extrema && /(?:worst|biggest|largest|max(?:imum)?)[\\s-]*(?:loss)?/.test(txt)) {\n            safe.extrema = {\n                field: \"pointsLost\",\n                mode: \"max\"\n            };\n        }\n        // Clamp page size\n        const reqSize = Number(safe.max_results);\n        safe.max_results = Number.isFinite(reqSize) && reqSize > 0 ? Math.min(reqSize, 10) : 10;\n        const { data } = await postJSON(`${_openai__WEBPACK_IMPORTED_MODULE_0__.TOOL_RUNNER_BASE_URL}/filter_losses`, safe);\n        return data;\n    }\n    return {\n        error: `Unknown tool: ${name}`\n    };\n}\nasync function runAssistantTurn({ threadId, userText }) {\n    // 1) Create or reuse thread\n    const thread = threadId ? {\n        id: threadId\n    } : await withRetry(()=>_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.create());\n    // 2) Add user message\n    await withRetry(()=>_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.messages.create(thread.id, {\n            role: \"user\",\n            content: userText\n        }));\n    // 3) Create run\n    let run = await withRetry(()=>_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.create(thread.id, {\n            assistant_id: _openai__WEBPACK_IMPORTED_MODULE_0__.ASSISTANT_ID\n        }));\n    // 4) Poll loop (handles tool calls and completion)\n    while(true){\n        run = await withRetry(()=>_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.retrieve(thread.id, run.id));\n        if (run.status === \"requires_action\") {\n            const toolCalls = run.required_action?.submit_tool_outputs?.tool_calls || [];\n            const outputs = await Promise.all(toolCalls.map(async (tc)=>{\n                const args = JSON.parse(tc.function.arguments || \"{}\");\n                // console.log(\"ðŸ”§ tool call ->\", tc.function.name, \"args:\", args);\n                const result = await callToolRunner(tc.function.name, args, userText);\n                return {\n                    tool_call_id: tc.id,\n                    output: JSON.stringify(result)\n                };\n            }));\n            await withRetry(()=>_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.runs.submitToolOutputs(thread.id, run.id, {\n                    tool_outputs: outputs\n                }));\n            continue; // keep polling\n        }\n        if (run.status === \"completed\") {\n            const msgs = await withRetry(()=>_openai__WEBPACK_IMPORTED_MODULE_0__.openai.beta.threads.messages.list(thread.id, {\n                    limit: 1,\n                    order: \"desc\"\n                }));\n            const latest = msgs.data[0];\n            const text = latest?.content?.[0]?.type === \"text\" ? latest.content[0].text.value : \"\";\n            return {\n                threadId: thread.id,\n                text\n            };\n        }\n        if ([\n            \"failed\",\n            \"cancelled\",\n            \"expired\"\n        ].includes(run.status)) {\n            throw new Error(`Run ended with status: ${run.status}`);\n        }\n        // small wait to avoid rate limits\n        await new Promise((r)=>setTimeout(r, 600));\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQUNHLFFBQVEsQ0FBQzVCLElBQUk1RSxNQUFNLEdBQWE7WUFDckUsTUFBTSxJQUFJVSxNQUFNLENBQUMsdUJBQXVCLEVBQUVrRSxJQUFJNUUsTUFBTSxDQUFDLENBQUM7UUFDeEQ7UUFFQSxrQ0FBa0M7UUFDbEMsTUFBTSxJQUFJTyxRQUFRLENBQUNDLElBQU1DLFdBQVdELEdBQUc7SUFDekM7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21lbnRvci1jaGF0LXVpLy4vc3JjL2xpYi9ydW5Bc3Npc3RhbnQudHM/N2Y4ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAvdHJhZGVoYWJpdC1iYWNrZW5kL21lbnRvci9jaGF0LXVpL3NyYy9saWIvcnVuQXNzaXN0YW50LnRzXG5pbXBvcnQgeyBvcGVuYWksIEFTU0lTVEFOVF9JRCwgVE9PTF9SVU5ORVJfQkFTRV9VUkwgfSBmcm9tIFwiLi9vcGVuYWlcIjtcblxudHlwZSBUb29sQ2FsbCA9IHtcbiAgaWQ6IHN0cmluZztcbiAgdHlwZTogXCJmdW5jdGlvblwiO1xuICBmdW5jdGlvbjogeyBuYW1lOiBzdHJpbmc7IGFyZ3VtZW50czogc3RyaW5nIH07XG59O1xuXG4vLyAtLS0tLS0tLS0tIHRpbnkgcmV0cnkvYmFja29mZiBmb3IgT3BlbkFJIDQyOXMgLS0tLS0tLS0tLVxuYXN5bmMgZnVuY3Rpb24gd2l0aFJldHJ5PFQ+KGZuOiAoKSA9PiBQcm9taXNlPFQ+LCB0cmllcyA9IDMpIHtcbiAgbGV0IGRlbGF5ID0gODAwO1xuICBsZXQgbGFzdEVycjogYW55O1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaWVzOyBpKyspIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGZuKCk7XG4gICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICBsYXN0RXJyID0gZTtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IGU/LnN0YXR1cyB8fCBlPy5yZXNwb25zZT8uc3RhdHVzO1xuICAgICAgY29uc3QgbXNnID0gZT8ubWVzc2FnZSB8fCBlPy5yZXNwb25zZT8uZGF0YSB8fCBcIlwiO1xuICAgICAgY29uc3QgcmF0ZUxpbWl0ZWQgPSBzdGF0dXMgPT09IDQyOSB8fCAvcmF0ZSBsaW1pdHxUb28gTWFueSBSZXF1ZXN0cy9pLnRlc3QobXNnKTtcbiAgICAgIGlmICghcmF0ZUxpbWl0ZWQpIGJyZWFrO1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHIpID0+IHNldFRpbWVvdXQociwgZGVsYXkpKTtcbiAgICAgIGRlbGF5ICo9IDI7XG4gICAgfVxuICB9XG4gIHRocm93IGxhc3RFcnIgfHwgbmV3IEVycm9yKFwiUmV0cnkgbGltaXQgcmVhY2hlZFwiKTtcbn1cblxuLy8gLS0tLS0tLS0tLSBoZWxwZXI6IHNhZmUgUE9TVCBKU09OIHRvIHRvb2xfcnVubmVyIC0tLS0tLS0tLS1cbmFzeW5jIGZ1bmN0aW9uIHBvc3RKU09OKHVybDogc3RyaW5nLCBwYXlsb2FkOiBhbnkpOiBQcm9taXNlPHsgb2s6IGJvb2xlYW47IGRhdGE6IGFueSB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogeyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCA/PyB7fSlcbiAgICB9KTtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcbiAgICByZXR1cm4geyBvazogcmVzLm9rLCBkYXRhIH07XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIHJldHVybiB7XG4gICAgICBvazogZmFsc2UsXG4gICAgICBkYXRhOiB7IHN0YXR1czogXCJFUlJPUlwiLCBtZXNzYWdlOiBgdG9vbF9ydW5uZXIgZmV0Y2ggZmFpbGVkOiAke2U/Lm1lc3NhZ2UgfHwgU3RyaW5nKGUpfWAgfVxuICAgIH07XG4gIH1cbn1cblxuLy8gLS0tLS0tLS0tLSB0b29sIHJ1bm5lciBicmlkZ2UgLS0tLS0tLS0tLVxuYXN5bmMgZnVuY3Rpb24gY2FsbFRvb2xSdW5uZXIobmFtZTogc3RyaW5nLCBhcmdzOiBhbnksIHVzZXJUZXh0Pzogc3RyaW5nKSB7XG4gIC8vIGdldF9zdW1tYXJ5X2RhdGEgaXMgYWx3YXlzIHRpbnlcbiAgaWYgKG5hbWUgPT09IFwiZ2V0X3N1bW1hcnlfZGF0YVwiKSB7XG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBwb3N0SlNPTihgJHtUT09MX1JVTk5FUl9CQVNFX1VSTH0vZ2V0X3N1bW1hcnlfZGF0YWAsIHt9KTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIC8vIGdldF9lbmRwb2ludF9kYXRhIHdpdGggc2FmZSBkZWZhdWx0cyBhbmQgZmFsbGJhY2sgdG8ga2V5c19vbmx5XG4gIGlmIChuYW1lID09PSBcImdldF9lbmRwb2ludF9kYXRhXCIpIHtcbiAgICBjb25zdCBzYWZlQXJnczogYW55ID0geyAuLi4oYXJncyB8fCB7fSkgfTtcbiAgXG4gICAgLy8gR3VhcmQgYWdhaW5zdCBmdWxsLWZpbGUgZHVtcHMgdW5sZXNzIHBhZ2luZyBhIHRvcC1sZXZlbCBhcnJheVxuICAgIGNvbnN0IGNhbGxlclNwZWNpZmllZEtleXNPbmx5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNhZmVBcmdzLCBcImtleXNfb25seVwiKTtcbiAgICBpZiAoIWNhbGxlclNwZWNpZmllZEtleXNPbmx5ICYmICFzYWZlQXJncy50b3ApIHNhZmVBcmdzLmtleXNfb25seSA9IHRydWU7XG4gIFxuICAgIC8vIElmIHBhZ2luZyBhIGJpZyBhcnJheSBhbmQgbm8gcHJvamVjdGlvbiBzcGVjaWZpZWQsIGtlZXAgaXQgbGVhblxuICAgIGlmIChzYWZlQXJncy50b3AgPT09IFwidHJhZGVzXCIgJiYgIUFycmF5LmlzQXJyYXkoc2FmZUFyZ3MuZmllbGRzKSkge1xuICAgICAgc2FmZUFyZ3MuZmllbGRzID0gW1wiaWRcIiwgXCJlbnRyeVRpbWVcIiwgXCJzeW1ib2xcIiwgXCJwbmxcIiwgXCJtaXN0YWtlc1wiXTtcbiAgICB9XG4gIFxuICAgIC8vIENsYW1wIHBhZ2Ugc2l6ZVxuICAgIGNvbnN0IHJlcVNpemUgPSBOdW1iZXIoc2FmZUFyZ3MubWF4X3Jlc3VsdHMpO1xuICAgIHNhZmVBcmdzLm1heF9yZXN1bHRzID0gTnVtYmVyLmlzRmluaXRlKHJlcVNpemUpICYmIHJlcVNpemUgPiAwID8gTWF0aC5taW4ocmVxU2l6ZSwgMTApIDogMTA7XG4gIFxuICAgIC8vIEZpcnN0IGF0dGVtcHRcbiAgICBsZXQgeyBvaywgZGF0YSB9ID0gYXdhaXQgcG9zdEpTT04oYCR7VE9PTF9SVU5ORVJfQkFTRV9VUkx9L2dldF9lbmRwb2ludF9kYXRhYCwgc2FmZUFyZ3MpO1xuICBcbiAgICAvLyBJZiB0aGUgc2VydmVyIGVycm9yZWQgKGJhZCBgdG9wYCwgZXRjLikg4oaSIGZhbGxiYWNrIHRvIGtleXNfb25seVxuICAgIGlmICghb2spIHtcbiAgICAgICh7IGRhdGEgfSA9IGF3YWl0IHBvc3RKU09OKGAke1RPT0xfUlVOTkVSX0JBU0VfVVJMfS9nZXRfZW5kcG9pbnRfZGF0YWAsIHtcbiAgICAgICAgbmFtZTogc2FmZUFyZ3MubmFtZSxcbiAgICAgICAga2V5c19vbmx5OiB0cnVlXG4gICAgICB9KSk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gIFxuICAgIC8vIElmIHdlIGRlZmF1bHRlZCB0byBrZXlzX29ubHkgYW5kIHRoZSBwYXlsb2FkIGxvb2tzIHNjYWxhci1vbmx5IChubyBhcnJheXMpLFxuICAgIC8vIGF1dG8tZmV0Y2ggdGhlIGZ1bGwgc25hcHNob3Qgc28gRnJhbmtsaW4gY2FuIHJlYWQgYWN0dWFsIHZhbHVlcy5cbiAgICBjb25zdCB3ZURlZmF1bHRlZEtleXNPbmx5ID0gIWNhbGxlclNwZWNpZmllZEtleXNPbmx5ICYmICFhcmdzPy50b3A7XG4gICAgY29uc3QgbG9va3NTY2FsYXJPbmx5ID1cbiAgICAgIGRhdGEgJiZcbiAgICAgIHR5cGVvZiBkYXRhID09PSBcIm9iamVjdFwiICYmXG4gICAgICBBcnJheS5pc0FycmF5KGRhdGEua2V5cykgJiZcbiAgICAgIGRhdGEua2V5cy5sZW5ndGggPiAwICYmXG4gICAgICBkYXRhLmFycmF5X2xlbmd0aHMgJiZcbiAgICAgIE9iamVjdC52YWx1ZXMoZGF0YS5hcnJheV9sZW5ndGhzKS5ldmVyeSgobjogYW55KSA9PiB0eXBlb2YgbiA9PT0gXCJudW1iZXJcIiAmJiBuID09PSAwKTtcbiAgXG4gICAgaWYgKHdlRGVmYXVsdGVkS2V5c09ubHkgJiYgbG9va3NTY2FsYXJPbmx5KSB7XG4gICAgICBjb25zdCBmdWxsID0gYXdhaXQgcG9zdEpTT04oYCR7VE9PTF9SVU5ORVJfQkFTRV9VUkx9L2dldF9lbmRwb2ludF9kYXRhYCwge1xuICAgICAgICBuYW1lOiBzYWZlQXJncy5uYW1lXG4gICAgICAgIC8vIG5vIGtleXNfb25seSDihpIgZnVsbCBzbmFwc2hvdFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZnVsbC5kYXRhO1xuICAgIH1cbiAgXG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cbiAgXG5cbiAgLy8gZmlsdGVyX3RyYWRlc1xuICBpZiAobmFtZSA9PT0gXCJmaWx0ZXJfdHJhZGVzXCIpIHtcbiAgICBjb25zdCBzYWZlOiBhbnkgPSB7IGluY2x1ZGVfdG90YWw6IHRydWUsIC4uLihhcmdzIHx8IHt9KSB9O1xuXG4gICAgLy8gU3RyaXAgcGxhY2Vob2xkZXIgJ2FueSdcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzYWZlLm1pc3Rha2VzKSkge1xuICAgICAgc2FmZS5taXN0YWtlcyA9IHNhZmUubWlzdGFrZXMuZmlsdGVyKFxuICAgICAgICAobTogc3RyaW5nKSA9PiAobSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpICE9PSBcImFueVwiXG4gICAgICApO1xuICAgICAgaWYgKHNhZmUubWlzdGFrZXMubGVuZ3RoID09PSAwKSBkZWxldGUgc2FmZS5taXN0YWtlcztcbiAgICB9XG5cbiAgICAvLyBEZWZhdWx0IHByb2plY3Rpb25cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2FmZS5maWVsZHMpKSB7XG4gICAgICBzYWZlLmZpZWxkcyA9IFtcImlkXCIsIFwiZW50cnlUaW1lXCIsIFwic3ltYm9sXCIsIFwicG5sXCIsIFwibWlzdGFrZXNcIl07XG4gICAgfVxuXG4gICAgLy8gQ2xhbXAgcGFnZSBzaXplXG4gICAgY29uc3QgcmVxU2l6ZSA9IE51bWJlcihzYWZlLm1heF9yZXN1bHRzKTtcbiAgICBzYWZlLm1heF9yZXN1bHRzID0gTnVtYmVyLmlzRmluaXRlKHJlcVNpemUpICYmIHJlcVNpemUgPiAwID8gTWF0aC5taW4ocmVxU2l6ZSwgMTApIDogMTA7XG5cbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHBvc3RKU09OKGAke1RPT0xfUlVOTkVSX0JBU0VfVVJMfS9maWx0ZXJfdHJhZGVzYCwgc2FmZSk7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICAvLyBmaWx0ZXJfbG9zc2VzXG4gIGlmIChuYW1lID09PSBcImZpbHRlcl9sb3NzZXNcIikge1xuICAgIGNvbnN0IHNhZmU6IGFueSA9IHsgaW5jbHVkZV90b3RhbDogdHJ1ZSwgLi4uKGFyZ3MgfHwge30pIH07XG5cbiAgICAvLyBEZWZhdWx0IHByb2plY3Rpb25cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2FmZS5maWVsZHMpKSB7XG4gICAgICBzYWZlLmZpZWxkcyA9IFtcImV4aXRPcmRlcklkXCIsIFwiZW50cnlUaW1lXCIsIFwicG9pbnRzTG9zdFwiLCBcInN5bWJvbFwiLCBcInNpZGVcIiwgXCJoYXNNaXN0YWtlXCJdO1xuICAgIH1cblxuICAgIC8vIE9wdGlvbmFsIG51ZGdlIGZvciDigJx3b3JzdC9iaWdnZXN0L2xhcmdlc3QvbWF4IGxvc3PigJ1cbiAgICBjb25zdCB0eHQgPSAodHlwZW9mIHVzZXJUZXh0ID09PSBcInN0cmluZ1wiID8gdXNlclRleHQgOiBcIlwiKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmICghc2FmZS5leHRyZW1hICYmIC8oPzp3b3JzdHxiaWdnZXN0fGxhcmdlc3R8bWF4KD86aW11bSk/KVtcXHMtXSooPzpsb3NzKT8vLnRlc3QodHh0KSkge1xuICAgICAgc2FmZS5leHRyZW1hID0geyBmaWVsZDogXCJwb2ludHNMb3N0XCIsIG1vZGU6IFwibWF4XCIgfTtcbiAgICB9XG5cbiAgICAvLyBDbGFtcCBwYWdlIHNpemVcbiAgICBjb25zdCByZXFTaXplID0gTnVtYmVyKHNhZmUubWF4X3Jlc3VsdHMpO1xuICAgIHNhZmUubWF4X3Jlc3VsdHMgPSBOdW1iZXIuaXNGaW5pdGUocmVxU2l6ZSkgJiYgcmVxU2l6ZSA+IDAgPyBNYXRoLm1pbihyZXFTaXplLCAxMCkgOiAxMDtcblxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgcG9zdEpTT04oYCR7VE9PTF9SVU5ORVJfQkFTRV9VUkx9L2ZpbHRlcl9sb3NzZXNgLCBzYWZlKTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIHJldHVybiB7IGVycm9yOiBgVW5rbm93biB0b29sOiAke25hbWV9YCB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcnVuQXNzaXN0YW50VHVybih7XG4gIHRocmVhZElkLFxuICB1c2VyVGV4dFxufToge1xuICB0aHJlYWRJZD86IHN0cmluZztcbiAgdXNlclRleHQ6IHN0cmluZztcbn0pIHtcbiAgLy8gMSkgQ3JlYXRlIG9yIHJldXNlIHRocmVhZFxuICBjb25zdCB0aHJlYWQgPVxuICAgIHRocmVhZElkID8geyBpZDogdGhyZWFkSWQgfSA6IGF3YWl0IHdpdGhSZXRyeSgoKSA9PiBvcGVuYWkuYmV0YS50aHJlYWRzLmNyZWF0ZSgpKTtcblxuICAvLyAyKSBBZGQgdXNlciBtZXNzYWdlXG4gIGF3YWl0IHdpdGhSZXRyeSgoKSA9PlxuICAgIG9wZW5haS5iZXRhLnRocmVhZHMubWVzc2FnZXMuY3JlYXRlKHRocmVhZC5pZCwge1xuICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICBjb250ZW50OiB1c2VyVGV4dFxuICAgIH0pXG4gICk7XG5cbiAgLy8gMykgQ3JlYXRlIHJ1blxuICBsZXQgcnVuID0gYXdhaXQgd2l0aFJldHJ5KCgpID0+XG4gICAgb3BlbmFpLmJldGEudGhyZWFkcy5ydW5zLmNyZWF0ZSh0aHJlYWQuaWQsIHtcbiAgICAgIGFzc2lzdGFudF9pZDogQVNTSVNUQU5UX0lEXG4gICAgfSlcbiAgKTtcblxuICAvLyA0KSBQb2xsIGxvb3AgKGhhbmRsZXMgdG9vbCBjYWxscyBhbmQgY29tcGxldGlvbilcbiAgd2hpbGUgKHRydWUpIHtcbiAgICBydW4gPSBhd2FpdCB3aXRoUmV0cnkoKCkgPT5cbiAgICAgIG9wZW5haS5iZXRhLnRocmVhZHMucnVucy5yZXRyaWV2ZSh0aHJlYWQuaWQsIHJ1bi5pZClcbiAgICApO1xuXG4gICAgaWYgKHJ1bi5zdGF0dXMgPT09IFwicmVxdWlyZXNfYWN0aW9uXCIpIHtcbiAgICAgIGNvbnN0IHRvb2xDYWxscyA9IChydW4ucmVxdWlyZWRfYWN0aW9uPy5zdWJtaXRfdG9vbF9vdXRwdXRzPy50b29sX2NhbGxzIHx8IFtdKSBhcyBUb29sQ2FsbFtdO1xuXG4gICAgICBjb25zdCBvdXRwdXRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIHRvb2xDYWxscy5tYXAoYXN5bmMgKHRjKSA9PiB7XG4gICAgICAgICAgY29uc3QgYXJncyA9IEpTT04ucGFyc2UodGMuZnVuY3Rpb24uYXJndW1lbnRzIHx8IFwie31cIik7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCLwn5SnIHRvb2wgY2FsbCAtPlwiLCB0Yy5mdW5jdGlvbi5uYW1lLCBcImFyZ3M6XCIsIGFyZ3MpO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbGxUb29sUnVubmVyKHRjLmZ1bmN0aW9uLm5hbWUsIGFyZ3MsIHVzZXJUZXh0KTtcbiAgICAgICAgICByZXR1cm4geyB0b29sX2NhbGxfaWQ6IHRjLmlkLCBvdXRwdXQ6IEpTT04uc3RyaW5naWZ5KHJlc3VsdCkgfTtcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IHdpdGhSZXRyeSgoKSA9PlxuICAgICAgICBvcGVuYWkuYmV0YS50aHJlYWRzLnJ1bnMuc3VibWl0VG9vbE91dHB1dHModGhyZWFkLmlkLCBydW4uaWQsIHtcbiAgICAgICAgICB0b29sX291dHB1dHM6IG91dHB1dHNcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIGNvbnRpbnVlOyAvLyBrZWVwIHBvbGxpbmdcbiAgICB9XG5cbiAgICBpZiAocnVuLnN0YXR1cyA9PT0gXCJjb21wbGV0ZWRcIikge1xuICAgICAgY29uc3QgbXNncyA9IGF3YWl0IHdpdGhSZXRyeSgoKSA9PlxuICAgICAgICBvcGVuYWkuYmV0YS50aHJlYWRzLm1lc3NhZ2VzLmxpc3QodGhyZWFkLmlkLCB7IGxpbWl0OiAxLCBvcmRlcjogXCJkZXNjXCIgfSlcbiAgICAgICk7XG4gICAgICBjb25zdCBsYXRlc3QgPSBtc2dzLmRhdGFbMF07XG4gICAgICBjb25zdCB0ZXh0ID1cbiAgICAgICAgbGF0ZXN0Py5jb250ZW50Py5bMF0/LnR5cGUgPT09IFwidGV4dFwiXG4gICAgICAgICAgPyBsYXRlc3QuY29udGVudFswXS50ZXh0LnZhbHVlXG4gICAgICAgICAgOiBcIlwiO1xuICAgICAgcmV0dXJuIHsgdGhyZWFkSWQ6IHRocmVhZC5pZCwgdGV4dCB9O1xuICAgIH1cblxuICAgIGlmIChbXCJmYWlsZWRcIiwgXCJjYW5jZWxsZWRcIiwgXCJleHBpcmVkXCJdLmluY2x1ZGVzKHJ1bi5zdGF0dXMgYXMgc3RyaW5nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSdW4gZW5kZWQgd2l0aCBzdGF0dXM6ICR7cnVuLnN0YXR1c31gKTtcbiAgICB9XG5cbiAgICAvLyBzbWFsbCB3YWl0IHRvIGF2b2lkIHJhdGUgbGltaXRzXG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHIpID0+IHNldFRpbWVvdXQociwgNjAwKSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJvcGVuYWkiLCJBU1NJU1RBTlRfSUQiLCJUT09MX1JVTk5FUl9CQVNFX1VSTCIsIndpdGhSZXRyeSIsImZuIiwidHJpZXMiLCJkZWxheSIsImxhc3RFcnIiLCJpIiwiZSIsInN0YXR1cyIsInJlc3BvbnNlIiwibXNnIiwibWVzc2FnZSIsImRhdGEiLCJyYXRlTGltaXRlZCIsInRlc3QiLCJQcm9taXNlIiwiciIsInNldFRpbWVvdXQiLCJFcnJvciIsInBvc3RKU09OIiwidXJsIiwicGF5bG9hZCIsInJlcyIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwianNvbiIsImNhdGNoIiwib2siLCJTdHJpbmciLCJjYWxsVG9vbFJ1bm5lciIsIm5hbWUiLCJhcmdzIiwidXNlclRleHQiLCJzYWZlQXJncyIsImNhbGxlclNwZWNpZmllZEtleXNPbmx5IiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwidG9wIiwia2V5c19vbmx5IiwiQXJyYXkiLCJpc0FycmF5IiwiZmllbGRzIiwicmVxU2l6ZSIsIk51bWJlciIsIm1heF9yZXN1bHRzIiwiaXNGaW5pdGUiLCJNYXRoIiwibWluIiwid2VEZWZhdWx0ZWRLZXlzT25seSIsImxvb2tzU2NhbGFyT25seSIsImtleXMiLCJsZW5ndGgiLCJhcnJheV9sZW5ndGhzIiwidmFsdWVzIiwiZXZlcnkiLCJuIiwiZnVsbCIsInNhZmUiLCJpbmNsdWRlX3RvdGFsIiwibWlzdGFrZXMiLCJmaWx0ZXIiLCJtIiwidG9Mb3dlckNhc2UiLCJ0eHQiLCJleHRyZW1hIiwiZmllbGQiLCJtb2RlIiwiZXJyb3IiLCJydW5Bc3Npc3RhbnRUdXJuIiwidGhyZWFkSWQiLCJ0aHJlYWQiLCJpZCIsImJldGEiLCJ0aHJlYWRzIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInJ1biIsInJ1bnMiLCJhc3Npc3RhbnRfaWQiLCJyZXRyaWV2ZSIsInRvb2xDYWxscyIsInJlcXVpcmVkX2FjdGlvbiIsInN1Ym1pdF90b29sX291dHB1dHMiLCJ0b29sX2NhbGxzIiwib3V0cHV0cyIsImFsbCIsIm1hcCIsInRjIiwicGFyc2UiLCJmdW5jdGlvbiIsImFyZ3VtZW50cyIsInJlc3VsdCIsInRvb2xfY2FsbF9pZCIsIm91dHB1dCIsInN1Ym1pdFRvb2xPdXRwdXRzIiwidG9vbF9vdXRwdXRzIiwibXNncyIsImxpc3QiLCJsaW1pdCIsIm9yZGVyIiwibGF0ZXN0IiwidGV4dCIsInR5cGUiLCJ2YWx1ZSIsImluY2x1ZGVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/runAssistant.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/openai","vendor-chunks/form-data-encoder","vendor-chunks/whatwg-url","vendor-chunks/agentkeepalive","vendor-chunks/tr46","vendor-chunks/node-fetch","vendor-chunks/webidl-conversions","vendor-chunks/web-streams-polyfill","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fterry%2Fprojects%2Ftradehabit-backend%2Fmentor%2Fchat-ui&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();